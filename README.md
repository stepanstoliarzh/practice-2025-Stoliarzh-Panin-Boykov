# Проектная (учебная) практика

## Участники

| ФИО | Учебная группа | Код направления подготовки | Профиль образовательной программы |
|-|-|-|-|
| Столярж Степан Алексеевич | 241-353 | 10.03.01 | Безопасность компьютерных систем |
| Панин Данила Олегович | 241-351 | 10.03.01 | Безопасность компьютерных систем |
| Бойков Тимофей Анатольевич | 241-351 | 10.03.01 | Безопасность компьютерных систем |
## Задание

Задание размещено в папке **task** в файле [README.md](task/README.md).

## Вариативная часть задания

**Тип задания:** Кафедральное вариативное задание  
**Название:** Групповое задание, Методика внешней разведки корп. сети  
[Ссылка на распределение заданий (Google Docs)](https://docs.google.com/spreadsheets/d/e/2PACX-1vR_ZtqySS-Ozp3H3QZ-lBXXGKoroBFBGBPDlAVYCCwt2a9QvgdBblzaPhEJHrJ2PwCZ3YUY48_EOG-C/pubhtml?gid=1547202353&single=true)
1. Исследование предметной области

Цель: Получить глубокое понимание методов и инструментов внешней разведки корпоративных сетей, изучить их законность, применимость и реализовать их в виде практического проекта. Одной из ключевых целей является применение теоретических знаний на практике и развитие навыков автоматизации сбора информации. Также предполагается анализ правовых аспектов, применение методик в практических сценариях, моделирование потенциальных угроз и разработка способов противодействия.

Описание предметной области: Внешняя разведка корпоративной сети (external reconnaissance) — это этап сбора информации об организации и её инфраструктуре без активного вторжения во внутреннюю сеть. Это может включать в себя исследование доменов, поддоменов, IP-диапазонов, утечек данных, открытых сервисов и веб-приложений. Данная методика используется как в этичном хакерстве (пентестах), так и в процессе киберразведки.

Возможное применение:
  •	Тестирование безопасности компании до наступления этапа эксплуатации уязвимостей.
  •	Моделирование поведения злоумышленников (Red Team).
  •	Проверка утечек данных и публичной экспозиции.
  •	Подготовка к кибератакам и разработка стратегий защиты.
  
Законность: Применение методов внешней разведки законно при соблюдении ряда условий:
  •	Получено разрешение от владельца инфраструктуры (в рамках пентеста).
  •	Используются только пассивные методы, не нарушающие закон (например, OSINT).
  •	Не производится несанкционированный доступ к системам (даже при наличии уязвимостей).
  
Преимущества:
  •	Невидимость: можно оставаться незамеченным.
  •	Актуальность: получение «живой» информации о внешнем периметре.
  •	Универсальность: применимо как к крупным, так и к малым организациям.
  
Недостатки:
  •	Ограниченность данных (особенно при пассивной разведке).
  •	Возможность получения устаревшей или ложной информации.
  •	Юридические риски при переходе от разведки к сканированию.
  
Примеры использования:
  •	Red Team использует Amass и Shodan для составления карты внешней сети.
  •	Сотрудник SOC анализирует утечки данных с помощью LeakIX.
  •	Пентестер определяет используемые CMS и версии ПО для подготовки отчёта об уязвимостях.
  
Необходимость и актуальность: Современные атаки часто начинаются с этапа разведки. Чем меньше информации доступно извне — тем меньше шансов на успешную атаку. Поэтому анализ открытых источников должен быть неотъемлемой частью процесса обеспечения кибербезопасности.

Противодействие разведке:

  •	Минимизация публичной экспозиции: удаление лишних DNS-записей, скрытие панелей управления.
  •	Мониторинг запросов к DNS и сканирований.
  •	Использование WAF, CAPTCHA и rate limiting.
  •	Контроль за утечками, настройка систем DLP и мониторинг внешних ресурсов (например, Shodan Alerts).

1.1 Определение ключевых понятий

  •	OSINT (Open Source Intelligence) – сбор, систематизация и анализ информации из общедоступных источников: интернет-форумы, соцсети, поисковые системы, реестры и базы данных.
  
   o	Методы: Google Dorks, поиск в соцсетях, агрегаторы утечек.
   o	Преимущества: доступность, юридическая чистота.    
   o	Недостатки: неточность, устаревшие данные.
    
  •	Active Reconnaissance – взаимодействие с целевой системой с целью получения обратной информации (например, через сканирование портов, баннер-граббинг).
  
  o	Методы: nmap, masscan, сканирование уязвимостей.    
  o	Преимущества: точные и актуальные данные.    
  o	Недостатки: может быть обнаружено, юридические риски.
    
  •	Passive Reconnaissance – сбор информации о цели без прямого взаимодействия, например, анализ WHOIS, публичных записей DNS, утечек, SSL-сертификатов.

  o	Методы: crt.sh, DNSDumpster, Censys.    
  o	Преимущества: незаметность, законность.    
  o	Недостатки: ограниченность данных.
    
  •	Footprinting – создание карты целевой инфраструктуры: домены, поддомены, IP-диапазоны, связанные организации.
  
  o	Методы: Amass, sublist3r, WHOIS, ASN-слежение.    
  o	Преимущества: основа для дальнейшего анализа.    
  o	Недостатки: требует времени.
    
  •	Fingerprinting – определение версий используемого ПО (серверов, СУБД, CMS и др.).
  
  o	Методы: nmap -sV, banner grabbing, Wappalyzer.    
  o	Преимущества: целенаправленный анализ уязвимостей.    
  o	Недостатки: может быть заблокировано WAF.
   
1.2 Обзор основных методологий

1.	PTES (Penetration Testing Execution Standard)

  o	Этап Reconnaissance включает сбор всей возможной информации об инфраструктуре клиента.
  o	Пример: перед аудитом предприятия производится сканирование всех возможных публичных IP-адресов и доменов.

  2.	OWASP Testing Guide
  
  o	Раздел Information Gathering описывает методы анализа веб-приложений, начиная от поиска поддоменов до анализа конфигураций HTTP.
  o	Пример: выявление устаревших заголовков HTTP.
    
  3.	MITRE ATT&CK Framework

  o	Стандартизированная модель поведения злоумышленников. Включает этап Initial Access – сбор информации о жертве (T1590, T1592).
  o	Пример: атака с помощью утекших учётных данных и предварительного сбора информации через OSINT.
    
  •	Сравнение методологий:
  
    o	PTES ориентирован на проектное тестирование.
    o	OWASP – на безопасность веб-приложений.
    o	MITRE – на моделирование поведения атакующих.
    o	Их можно дополнять: сначала использовать PTES как скелет, затем применить OWASP для веб-компонентов и MITRE – для построения сценариев атак.

1.3 Классификация инструментов и их назначение
| Категория  | Инструмент | Описание использования | 
|-|-|-|
|DNS-разведка	|dig, DNSDumpster, sublist3r, Amass	|Поиск поддоменов, DNS-записи, извлечение зональных файлов при открытом AXFR.|
|Пассивный сбор данных	|Google Dorks, Shodan, Censys, crt.sh	|Поиск открытых устройств, сертификатов, метаданных и утечек.|
|Активное сканирование	|map, masscan, zmap	|Определение открытых портов, сервисов, OS-фингерпринтинг.|
|Web-разведка	|Burp Suite, OWASP ZAP, dirsearch, whatweb	|Поиск скрытых директорий, CMS, версий, анализ конфигурации веб-приложений.|
|API и скрипты	|Python (requests, BeautifulSoup), Recon-ng	|Автоматизация сбора, скрейпинг сайтов, интеграция с API Censys/Shodan/VirusTotal.|
|Поиск утечек данных	|HaveIBeenPwned, IntelligenceX, LeakIX	|Проверка наличия учётных записей и конфиденциальных файлов в утечках.|
|Поиск сотрудников	|LinkedIn + Maltego, Hunter.io	|Идентификация сотрудников, email-структур, персонализированный фишинг.|

1.4 Сравнение и критерии выбора инструментов
| Критерий | Пояснение | 
|-|-|
|Удобство использования	|CLI или GUI, кроссплатформенность, документация.|
|Скорость выполнения	|Время обработки больших диапазонов, параллельность.|
|Точность результатов	|Уровень ложных срабатываний и полнота данных.|
|Гибкость автоматизации	|Поддержка API, возможность интеграции в пайплайны.|
|Обновляемость	|Частота обновлений, поддержка новых техник и сервисов.|
|Юридическая безопасность	|Законность применения в различных юрисдикциях.|
|Поддержка сообществом	|Форумы, гайды, обучающие материалы.|
|Анонимность и OPSEC	|Возможность использования через VPN, Tor, без сохранения логов.|
|Совместимость	|Возможность интеграции с другими инструментами или CI/CD.|
|Многофункциональность|	Универсальность, количество задач, которые может решать инструмент.|

Рекомендованный набор инструментов
  1.	Amass – мощный инструмент для сбора поддоменов и построения графов связей.
  2.	Shodan – API-интерфейс для поиска открытых устройств по IP и сервисам.
  3.	nmap – классический инструмент сетевого сканирования с множеством скриптов NSE.
  4.	sublist3r – легковесный и быстрый сбор поддоменов.
  5.	Recon-ng – модульный фреймворк, удобный для скриптов и пайплайнов.
  6.	Python (requests, BeautifulSoup) – универсальная платформа для кастомных решений.
  7.	LeakIX, crt.sh – для поиска экспозиций и утечек.
  8.	Hunter.io – для выявления email-структур домена.
1.5 Практические шаги для быстрого старта
  1.	Установка среды:
  2.	sudo apt update
  3.	sudo apt install amass nmap sublist3r python3-pip
  pip3 install shodan requests beautifulsoup4 recon-ng
  4.	Базовая проверка:
  5.	amass enum -d example.com -o amass_subs.txt
  nmap -sS -Pn -p- -oN full_scan.txt example.com
  6.	Формирование отчёта:
    o	Таблица: поддомены, IP, открытые порты, версии сервисов.
    o	Скриншоты веб-интерфейсов (через aquatone или gowitness).
    o	Перечень потенциальных векторов атаки на основе MITRE.

2.1 Введение в глубокую разведку

В этом разделе собраны расширенные методики, подробные инструкции, шаблоны отчетов и рекомендации экспертов для каждодневного применения в рамках внешней разведки корпоративных сетей.

Цели дополнения:

Обеспечить полный набор готовых к использованию скриптов, конфигураций и шаблонов.

Предоставить расширенные примеры работы с каждым инструментом.

Описать шаблоны отчетов и автоматизированные генераторы.

Включить рекомендации по интеграции разведки в процессы SecOps.

2.2 Расширенная установка и конфигурация инструментов

2.2.1 Docker-контейнер all-in-one

FROM kalilinux/kali-rolling

RUN apt-get update && \
    apt-get install -y \
      amass nmap masscan sublist3r python3-pip burpsuite zaproxy \
      git golang-go jq chromium-browser \
      awscli terraform \
    && pip3 install \
      shodan requests beautifulsoup4 recon-ng maltego \
      theHarvester deadwood \
    && go get github.com/projectdiscovery/nuclei/v2/cmd/nuclei \
    && go get github.com/OWASP/Amass/v3/... \
    && go get github.com/projectdiscovery/httpx/cmd/httpx

# Добавляем рабочую директорию
WORKDIR /root/recon

ENTRYPOINT ["/bin/bash"]

2.2.2 Настройка API-ключей (пример .env)

SHODAN_API_KEY=YOUR_SHODAN_KEY
CENSYS_UID=YOUR_CENSYS_UID
CENSYS_SECRET=YOUR_CENSYS_SECRET
LEAKIX_API_KEY=YOUR_LEAKIX_KEY
VT_API_KEY=YOUR_VIRUSTOTAL_KEY

2.3 Подробные скрипты автоматизации

2.3.1 recon_pipeline.py

#!/usr/bin/env python3
import os, subprocess, json, csv
from datetime import datetime

def load_env():
    from dotenv import load_dotenv
    load_dotenv()

# Этап 1: пассивная разведка

def passive_recon(domain):
    print(f"[+] {datetime.now()} Passive recon for {domain}")
    subprocess.run(["amass","enum","-d",domain,"-o","amass.txt"])
    subprocess.run(["sublist3r","-d",domain,"-o","s3r.txt"])
    # Shodan
    subprocess.run(["shodan","search",f"hostname:{domain}","--fields","ip_str,port,org,hostnames","-o","shodan.csv"])

# Этап 2: активная разведка

def active_recon(domain):
    print(f"[+] {datetime.now()} Active recon for {domain}")
    subprocess.run(["masscan","-p1-65535","--rate","1000","-oL","masscan.txt",domain])
    subprocess.run(["nmap","-sV","-iL","masscan.txt","-oN","nmap_services.txt"])

# Этап 3: веб-разведка

def web_recon(domain):
    print(f"[+] {datetime.now()} Web recon for {domain}")
    subprocess.run(["httpx","-l","s3r.txt","-o","httpx.txt"])
    # Сбор URL через gau
    subprocess.run(["gau","-subs","-t","50","-o","gau.txt",domain])

# Этап 4: утечки

def leaks_recon(domain):
    print(f"[+] {datetime.now()} Leaks recon for {domain}")
    subprocess.run(["leakix","scan",domain,"--output","leakix.json"])

# Этап 5: отчёт

def generate_report():
    print(f"[+] {datetime.now()} Generating report")
    # Объединяем результаты в CSV
    with open('master_report.csv','w',newline='') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(['IP/URL','Source','Info'])
        for fname in ['amass.txt','shodan.csv','httpx.txt']:
            try:
                with open(fname) as f:
                    for line in f:
                        writer.writerow([line.strip(), fname, ''])
            except:
                pass

if __name__=='__main__':
    load_env()
    target = os.getenv('TARGET_DOMAIN','example.com')
    passive_recon(target)
    active_recon(target)
    web_recon(target)
    leaks_recon(target)
    generate_report()

2.3.2 Шаблон GitHub Actions (recon.yml)

name: Recon Pipeline
on:
  push:
    branches: [ main ]
jobs:
  recon:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'
      - name: Build Docker image
        run: docker build -t recon:latest .
      - name: Run recon
        env:
          TARGET_DOMAIN: ${{ secrets.TARGET_DOMAIN }}
          SHODAN_API_KEY: ${{ secrets.SHODAN_API_KEY }}
        run: |
          docker run --rm -e TARGET_DOMAIN -e SHODAN_API_KEY recon:latest ./recon_pipeline.py
      - name: Upload report
        uses: actions/upload-artifact@v2
        with:
          name: recon-report
          path: master_report.csv

2.4 Шаблоны отчетов и документации

2.4.1 Шаблон markdown-отчета (report_template.md)

# Отчет по внешней разведке

**Дата:** {{ date }}
**Цель:** {{ target }}

## 1. Введение
Краткое описание целей и задач.

## 2. Пассивная разведка
- Поддомены: {{ поддомены }}
- SSL-сертификаты: {{ сертификаты }}

## 3. Активная разведка
| IP       | Порт | Сервис | Версия |
|----------|------|--------|--------|
| ...      | ...  | ...    | ...    |

## 4. Веб-разведка
- Найденные URL: {{ urls }}

## 5. Утечки
- Логиинги: {{ утечки }}

## 6. Рекомендации
- Меры защиты: WAF, rate limiting, мониторинг.

2.4.2 Генератор отчета на Python

import jinja2, csv, os

env = jinja2.Environment(loader=jinja2.FileSystemLoader('templates'))
 tmpl = env.get_template('report_template.md')
 data = {
     'date': datetime.now().strftime('%Y-%m-%d'),
     'target': os.getenv('TARGET_DOMAIN'),
     'поддомены': open('amass.txt').read().splitlines(),
     'сертификаты': open('crt.txt').read().splitlines(),
     'urls': open('httpx.txt').read().splitlines(),
     'утечки': json.load(open('leakix.json'))
 }
 with open('final_report.md','w') as f:
     f.write(tmpl.render(data))

2.5 Интеграция в SecOps и SOC

Встраивание результатов разведки в SIEM (например, Splunk, ELK) через готовые JSON-шаблоны.

Использование alerting (Shodan Alerts, Censys monitors) для непрерывной оценки экспозиции.

2.5.1 Пример парсера для ELK (Logstash config)

input {
  file {
    path => "/data/recon/*.json"
    codec => "json"
  }
}
output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "recon-%{+YYYY.MM.dd}"
  }
}

2.6 Рекомендации по обучению и ресурсам

Книги:

Michael Bazzell — OSINT Techniques

Justin Seitz — Black Hat Python

Курсы:

TryHackMe — OSINT Challenges

Hack The Box Academy — Recon & Enumeration

Онлайн-ресурсы:

Bellingcat OSINT Handbook

PublicWWW для поиска фрагментов кода на веб-страницах

## Ответственный по проектной (учебной) практике

**-Руководитель** практики от университета: Гневшев Александр Юрьевич  
**-Руководитель** практики от организации: Кесель Сергей Александрович

## Проектная деятельность

Проектная (учебная) практика проводилась в связке с выполнением проекта «Водный спорт (I курс)» по дисциплине «Проектная деятельность».  
**Куратор:** Лебедев Иван Николаевич

## Период проведения

С 31 марта 2025 г. по 21 мая 2025 г.
